# Use an official Node.js runtime as a parent image
FROM node:18

ARG AUTH0_DOMAIN=royerm.eu.auth0.com
ENV AUTH0_DOMAIN=$AUTH0_DOMAIN
ARG AUTH0_CLIENT_ID=${AUTH0_CLIENT_ID}
ENV AUTH0_CLIENT_ID=$AUTH0_CLIENT_ID
ARG AUTH0_SECRET=${AUTH0_SECRET}
ENV AUTH0_SECRET=$AUTH0_SECRET
ARG GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
ENV GOOGLE_CLIENT_ID=$GOOGLE_CLIENT_ID
ARG GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
ENV GOOGLE_CLIENT_SECRET=$GOOGLE_CLIENT_SECRET
ARG GOOGLE_DRIVE_FOLDER=${GOOGLE_DRIVE_FOLDER}
ENV GOOGLE_DRIVE_FOLDER=$GOOGLE_DRIVE_FOLDER
ARG API_BASE_URL=https://api.royerm.fr/
ENV API_BASE_URL=$API_BASE_URL
ARG FRONT_BASE_URL=https://unicorn.royerm.fr/
ENV FRONT_BASE_URL=$FRONT_BASE_URL
ARG GOOGLE_REDIRECT_URI=https://api.royerm.fr/auth/google/callback
ENV GOOGLE_REDIRECT_URI=$GOOGLE_REDIRECT_URI
ARG PORT=3001
ENV PORT=$PORT
ARG SERVER_HOST=127.0.0.1
ENV SERVER_HOST=$SERVER_HOST
ARG SERVER_PORT=$PORT
ENV SERVER_PORT=$SERVER_PORT

# Create and change to the app directory
WORKDIR /usr/src/app

# Install app dependencies
COPY package*.json ./
RUN npm install

# Bundle app source
COPY . .

# Expose the port the app runs on
EXPOSE $PORT

# Start the app
CMD ["npm", "start"]
